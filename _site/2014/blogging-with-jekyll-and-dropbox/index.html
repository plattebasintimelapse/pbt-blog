<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html>
<!--<![endif]-->

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    
    
    <meta name="description" content="The PBT Team Blog is built with Jekyll, a static site generator. It's powered by a Dropbox account and multiple authors, often from the road. How to do that.">
    
    
    <meta name="keywords" content="Platte Basin, timelapse, water, Nebraska, Wyoming, Colorado, river, wildlife, agriculture, blog">
    
    
	<meta http-equiv="date" content="Saturday, May 10, 2014">
	
	
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>Multiple Authors Blogging with Jekyll (Remotely) | Team PBT </title>

    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/style.css">
    <!-- <link href='http://fonts.googleapis.com/css?family=Lora:400,400italic' rel='stylesheet' type='text/css'> -->

    <script src="/js/jquery-2.1.1.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    
    <script type="text/javascript" src="//use.typekit.net/dlv3qjg.js"></script>
    <script type="text/javascript">try{Typekit.load();}catch(e){}</script>
</head>

<body>
    <nav class="navbar navbar-default" id="main-nav" role="navigation">
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#blog-navbar">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <div class="logo">
                    <a href="http://www.plattebasintimelapse.com">
                        <img id="logo-img" src="/images/PBT-logo.png" atl="PBT Logo" height="50" width="100">
                    </a>
                </div>
            </div>

            <div class="collapse navbar-collapse" id="blog-navbar">
                <ul class="nav navbar-nav" id="menu">
                    <li class="main-nav-item"><a href="/stories">Stories</a></li>
                    <li class="main-nav-item"><a href="/map">Explore</a></li>
                    <li class="main-nav-item"><a href="/blog">Notebook</a></li>
                    <li class="main-nav-item"><a href="/about">About</a></li>
                    <li class="main-nav-item"><a href="/blog/team">Team</a></li>
                </ul>
            </div><!-- /.navbar-collapse -->
        </div><!-- /.container-fluid -->
    </nav>

    <!-- <header id="site-header">
        <div id="logo">
            <a href="http://www.plattebasintimelapse.com">
                <img id="logo-img" src="/images/PBT-logo.png" atl="PBT Logo" height="50" width="100">
            </a>
                <h1>
                	
                    <a href="/">
                    <span id="logo-tag">Notebook</span>
                    </a>
                </h1>
            
        </div>

        <nav id="main-nav">
            <ul id="menu">
                <a href="/">
                    <li class="main-nav-item">
                        Home
                    </li>
                </a>
                <a href="/team/">
                    <li class="main-nav-item">
                        Team
                    </li>
                </a>
                <a href="/about/">
                    <li class="main-nav-item">
                        About
                    </li>
                </a>
            </ul>
        </nav>

    </header> -->
    <div class="container-fluid" id="main-content">

<article class="page entry">
    <header>
        <h3 class="post-title">Multiple Authors Blogging with Jekyll (Remotely)</h3>
        <p class="post-author">by <a href="/authors/speicher"> Steven Speicher</a></p> <!--author.name-->
    </header>
        
    <section class="post-content"><p>When I started conceiving of a blog for our team, I kept hearing the frustrated voices of others in my head. It was usually a voice bemoaning the cumbersome Drupal install we have powering our main site. I researched alternatives and quickly found <a href="http://www.jekyllrb.com">Jekyll</a>.</p>

<p><video width="100%" controls muted>
  <source src="http://scontent-a.cdninstagram.com/hphotos-xpf1/t50.2886-16/10461178_267030890156085_1461620786_n.mp4" type="video/mp4">
Your browser does not support the video tag.
</video></p>

<iframe src="http://instagram.com/p/pSW1ENFOng/embed" width="612" height="710" frameborder="0" scrolling="no" allowtransparency="true"></iframe>


<p>Besides teaching the team to use Markdown and some basics of how the web works, Jekyll was a great solution for a quick and easy blog. Pretty soon I had a page set up and running courtesy of <a href="https://pages.github.com/">Github pages</a>. It was wonderful and fast and awesome!</p>

<p>Once the shiny paint dried off, I realized it was impossible for anyone else on the team to post to the blog, unless they wanted to sign up for a Github account, learn how to push to a repository, .... (Actually, now that I write it down, it doesn't seem that difficult. And probably something I should have considered encouraging them all to do!)</p>

<p>Nonetheless, I approached the multiple author, remote worker problem with a different solution in mind:</p>

<ul>
<li>Get a single Dropbox account</li>
<li>Connect that account to our server</li>
<li>Put the Jekyll website there</li>
<li>Share <del>that folder</del> sub-folders with all necessary authors/contributors</li>
<li>Rebuild the site whenever something changes</li>
</ul>


<p>It sounded easy. So after a <a href="https://www.google.com/search?q=how+to+build+a+jekyll+website+with+dropbox&amp;oq=how+to+build+a+jekyll+website+with+dropbox&amp;aqs=chrome..69i57.4287j0j7&amp;sourceid=chrome&amp;es_sm=91&amp;ie=UTF-8">few Google searches</a> I set off with the necessary information to do just that. Here's what I did.</p>

<hr />

<h3>First things first</h3>

<p>I'm going to assume you already have a Jekyll website built. There are many great tutorials out there that do just this.</p>

<p>I'll refer to the <em>Jekyll folder</em> several times. By this, I mean the Jekyll source files (the <code>index.html</code> and <code>_config.yml</code> and <code>_posts</code> and <code>_layouts</code>, etc.), not the generated <code>_site</code> folder.</p>

<p>Jekyll has a built in <a href="http://jekyllrb.com/docs/usage/">development server</a> that you can flag with <code>--watch</code> to automatically regenerate the site locally. Use this to get a site fully built. You won't want to be making simple markup and style changes once it's deployed on Dropbox. It's painfully tedious to regenerate.</p>

<p>Before web deployment, make sure you have a <code>site.url</code> variable defined in the <code>_config.yml</code> file. Use absolute paths with <code>{{ site.url }}</code> whenever using static assets (i.e. <code>.css</code> and <code>.js</code> files or images).</p>

<p>You are also going to need Jekyll installed on your server. Depending on your setup, you'll have different steps. I'm doing this on an OSX machine via Terminal. My server is CentOS Linux. I don't know much about any of these things so I'm only including what worked for me.</p>

<hr />

<h3>Install Dropbox</h3>

<p><code>ssh</code> into your server. In my case, it's a Linux box run by a local company, <a href="http://www.binary.net/">Binary.net</a>. Following the instructions from Dropbox's <a href="https://www.dropbox.com/install?os=lnx">page</a>, run:</p>

<pre><code>cd ~ &amp;&amp; wget -O - "https://www.dropbox.com/download?plat=lnx.x86_64" | tar xzf -
</code></pre>

<p>for a 64-bit installation. Next, run the Dropbox daemon from the newly created <code>.dropbox-dist</code> folder.</p>

<pre><code>~/.dropbox-dist/dropboxd
</code></pre>

<p>Copy the link into your browser and login with a your Dropbox account. Although Dropbox provides an exclude feature, I recommend using a fresh Dropbox account without any extra folders in it. You should see a happy Dropbox is connected prompt on your server.</p>

<p>Once the Dropbox client on your server is successfully linked, it will automatically create a Dropbox folder at <code>~/Dropbox</code> for the user you’re logged in as. Since the Dropbox service isn’t actually running on your server yet you won’t be able to see any files until the client is running and has a check to synchronize.</p>

<p>You can manually start the Dropbox client by with:</p>

<pre><code>~/.dropbox-dist/dropbox
</code></pre>

<p>But, a better option is to setup service management script.</p>

<p>Create a file and paste the following code into that file:</p>

<pre><code>sudo vi /etc/init.d/dropbox

#!/bin/sh
# dropbox service
# Replace with linux users you want to run Dropbox clients for
DROPBOX_USERS="user1 user2"

DAEMON=.dropbox-dist/dropbox

start() {
    echo "Starting dropbox..."
    for dbuser in $DROPBOX_USERS; do
        HOMEDIR=`getent passwd $dbuser | cut -d: -f6`
        if [ -x $HOMEDIR/$DAEMON ]; then
            HOME="$HOMEDIR" start-stop-daemon -b -o -c $dbuser -S -u $dbuser -x $HOMEDIR/$DAEMON
        fi
    done
}

stop() {
    echo "Stopping dropbox..."
    for dbuser in $DROPBOX_USERS; do
        HOMEDIR=`getent passwd $dbuser | cut -d: -f6`
        if [ -x $HOMEDIR/$DAEMON ]; then
            start-stop-daemon -o -c $dbuser -K -u $dbuser -x $HOMEDIR/$DAEMON
        fi
    done
}

status() {
    for dbuser in $DROPBOX_USERS; do
        dbpid=`pgrep -u $dbuser dropbox`
        if [ -z $dbpid ] ; then
            echo "dropboxd for USER $dbuser: not running."
        else
            echo "dropboxd for USER $dbuser: running (pid $dbpid)"
        fi
    done
}

case "$1" in

    start)
        start
        ;;

    stop)
        stop
        ;;

    restart|reload|force-reload)
        stop
        start
        ;;

    status)
        status
        ;;

    *)
        echo "Usage: /etc/init.d/dropbox {start|stop|reload|force-reload|restart|status}"
        exit 1

esac

exit 0
</code></pre>

<p>Make sure you replace the value of DROPBOX_USERS with a comma separated list of the linux users on your machine you want to run the Dropbox client for.</p>

<p>Make the script executable and add it to the default system startup.</p>

<pre><code>sudo chmod +x /etc/init.d/dropbox
sudo update-rc.d dropbox defaults
</code></pre>

<p>Dropbox also has a separate python script that allows you to check on the status of the Dropbox client. I installed it with the rest of the <code>.dropbox</code> files.</p>

<pre><code>wget -O ~/.dropbox/dropbox.py "http://www.dropbox.com/download?dl=packages/dropbox.py"
chmod 755 ~/.dropbox/dropbox.py
</code></pre>

<p>You can start Dropbox if you haven't already with:</p>

<pre><code>~/.dropbox/dropbox.py start
</code></pre>

<p>And check the status of it with:</p>

<pre><code>~/.dropbox/dropbox.py status
</code></pre>

<p><em>This section was heavily lifted from <a href="http://ubuntuservergui.com/ubuntu-server-guide/install-dropbox-ubuntu-server">this blogpost</a></em></p>

<hr />

<h3>Configure Dropbox</h3>

<p>With Dropbox installed on your server, you should now log into your account via the Dropbox website and copy your Jekyll folder into the root of Dropbox. I called it something like <code>team-blog</code>.</p>

<p>If you check the status of your Dropbox,</p>

<pre><code>~/.dropbox/dropbox.py status
</code></pre>

<p>you will probably see that it is currently syncing all of your files. Yaay!</p>

<p>For security reasons and, in an attempt to not scare all of my team with source code, I created several sub-directories in the <code>_posts</code> directory, each titled something like <code>team-blog-posts-name</code> where the <code>name</code> is unique for each other. I also created a sub-directories under my <code>images</code> directory titled <code>team-blog-uploads</code>. This folder is empty as my parent <code>images</code> directory contains all additional assets needed to build the site.</p>

<p>It is these special folders I end up sharing with my team, <code>team-blog-posts-name</code> and <code>team-blog-uploads</code>. Each author gets their unique <code>post</code> folder and they all share the <code>upload</code>.</p>

<p>With this all set up, all authors can contribute to the blog and upload assets. Now we need to actually generate the site!</p>

<hr />

<h3>Generate the Jekyll Site</h3>

<p>To generate the site, you simply have to rebuild the source code each time a new blog post is added to one of the <code>post</code> directories. I used <a href="http://linux.die.net/man/5/incrontab">incronbtab</a> to do this. Install incrontab and then add your user to the <code>incron.allow</code> file.</p>

<pre><code>sudo vi /etc/incron.allow
</code></pre>

<p>In order to edit the incrontab, I had to change my EDITOR variable to vi. I think it's because I don't have vim install on my server but I'm not sure.</p>

<pre><code>export EDITOR=vi
</code></pre>

<p>Then edit the job with</p>

<pre><code>incrontab -e
</code></pre>

<p>Because incrontab is not recursive, you have to list each post sub-directory specifically. The syntax for incrontab job looks like</p>

<p><em>\<path to watch> \<file system event conditions> \<command></em>.</p>

<pre><code>/path/to/Dropbox/jekyll/_posts/named-post-folder IN_MODIFY,IN_DELETE,IN_CLOSE_WRITE,IN_MOVE jekyll build --source /path/to/Dropbox/jekyll --destination /var/www/html/sub-directory
</code></pre>

<p>I have a job for each authors post folder plus one for the assets upload folder, if an author wants to add a new picture to a completed post.</p>

<p>You can review your incrontab job with</p>

<pre><code>incrontab -l
</code></pre>

<hr />

<h3>Final Steps</h3>

<p>Share all of the necessary Dropbox directories with your team. You'll have to first add a file to a folder in order to generate the site originally. That is unless you already ran the <code>jekyll build</code> command.</p>

<p>Visit your site at the sub-directory created. Any new changes you make <em>to a post</em> should happen in real-time. Just refresh the browser to see the changes!</p>

<hr />

<h3>Bonus Stuff</h3>

<h4>Using Drafts</h4>

<h4>Styling in Mou</h4>
</section>
    
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'pbtteamblog'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</article>

	<footer>
    	<div class="social-media-icons">
    		<div class="social-media-icon" id="facebook"><a target="_blank" href="https://www.facebook.com/PlatteBasin"></a></div>
     		<div class="social-media-icon" id="twitter"><a target="_blank" href="https://twitter.com/PlatteBasin"></a></div> 
    	</div>
        <p>Brought to you courtesy of the <a href="http://www.plattebasintimelapse.com">Platte Basin Timelapse</a> team! | 2014</p>
    </footer>
    
    </div> <!-- .container -->

    <!--[if lt IE 7]>
            <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->

    <script>
        (function(b, o, i, l, e, r) {
            b.GoogleAnalyticsObject = l;
            b[l] || (b[l] =
                function() {
                    (b[l].q = b[l].q || []).push(arguments)
                });
            b[l].l = +new Date;
            e = o.createElement(i);
            r = o.getElementsByTagName(i)[0];
            e.src = '//www.google-analytics.com/analytics.js';
            r.parentNode.insertBefore(e, r)
        }(window, document, 'script', 'ga'));
        ga('create', 'UA-40570778-1');
        ga('send', 'pageview');
    </script>
</body>

</html>